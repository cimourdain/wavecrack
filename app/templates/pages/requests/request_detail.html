{% extends "common/layout.html" %}
{% block body %}
    <h2>Request</h2>
    <div class="row">
        <div class="col-sm-4">
            <div>Launched by: {{ request.user.name }}</div>
            <div>Launch time : {{ request.start_date.strftime('%Y-%m-%d %H:%M:%S') }}</div>
            <div>Status: {{ request.status }}</div>
        </div>
        <div class="col-sm-4">
            <div>
                <a href="{{ url_for('requests_get.download_original_password_file', request_id=request.id) }}">Hashes</a>
                {% if request.hashed_file_contains_usernames %}(contains usernames){% endif %}
            </div>
            <div>
                Hashes type: {{ request.hashes_type_label }}
            </div>
            <div>
                Dictionaries: {% for d in request.dictionary_paths %}{{ d }}, {% endfor %}
            </div>

        </div>
        <div class="col-sm-4">
            <div>Nb passwords found: {{ request.nb_password_found }}/{{ request.nb_password_to_find }} ({{ (request.nb_password_found / request.nb_password_to_find) *100 |round(2) }}%)</div>
            <div>
                <a href="{{ url_for('requests_get.download_output_file', request_id=request.id) }}">Output</a>
            </div>
            {% if request.is_running() %}
            <div>
                <form action="" method="POST">
                    <button type="button" class="btn btn-danger">Cancel all cracks</button>
                </form>
            </div>
            {% endif %}
        </div>
    </div>
    <h2>Cracks</h2>
    <div class="row">
    {% for crack in request.cracks %}
        <div class="col-sm-6">
            <div class="card" style="width: 18rem;">
              <div class="card-body">
                <h5 class="card-title">{{ crack.name }}</h5>
                {% if crack.start_date %}
                <h6 class="card-subtitle mb-2 text-muted">{{ crack.nb_password_found }} password found.</h6>
                <p>Start : {{ crack.start_date.strftime('%Y-%m-%d %H:%M:%S') }}</p>
                {% if crack.end_date %}
                    <p>End: {{ crack.end_date.strftime('%Y-%m-%d %H:%M:%S') }}</p>
                    <p>End status: {{ crack.end_status_mode }}</p>
                {% else %}
                    <p>Status: running: {{ crack.process_id }}</p>
                    <div>
                        <form action="{{ url_for('cracks_post.kill_crack', crack_id=crack.id) }}" method="POST">
                            <button type="submit" class="btn btn-danger">Cancel crack</button>
                        </form>
                    </div>
                {% endif %}
                <p class="card-text">{{ crack.cmd }}</p>
                  {% if  crack.nb_password_found %}
                      <a href="{{ url_for('cracks_get.download_crack_outfile', crack_id=crack.id) }}" class="card-link">Output</a>
                  {% endif %}
                {% else %}
                    <p>Not started</p>
                {% endif %}
              </div>
            </div>
        </div>
    {% endfor %}
    </div>
{% endblock %}